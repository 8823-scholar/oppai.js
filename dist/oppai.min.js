/*! oppai.js / @version:0.0.0 @author:dameleon <dameleon@gmail.com> @license:MIT */ 
!function(global,document,undefined){function Oppai(a,b,c,d){return this instanceof Oppai?this.init(a,b,c,d):new Oppai(a,b,c,d)}function Animation2D(a){return this instanceof Animation2D?this.init(a):new Animation2D(a)}function getRangedNumber(a,b,c){return b>=a?b:a>=c?c:a}function getTouchInfo(a,b){return supportTouch?a.changedTouches[0][b]:a[b]}var NS="oppai",supportTouch="ontouchstart"in global,events={touchStart:supportTouch?"touchstart":"mousedown",touchMove:supportTouch?"touchmove":"mousemove",touchEnd:supportTouch?"touchend":"mouseup"},isSmartphone=supportTouch,easingFunctions={linear:function(a,b,c,d){return c*a/d+b},bounseout:function(a,b,c,d){return(a/=d)<1/3?10.5625*c*a*a+b:2/3>a?c*(10.5625*(a-=1.5/2.75)*a+.75)+b:2.5/3>a?c*(10.5625*(a-=2.25/2.75)*a+.9375)+b:c*(10.5625*(a-=2.625/2.75)*a+.984375)+b}};global.requestAnimationFrame=global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.oRequestAnimationFrame||global.msRequestAnimationFrame||function(a){global.setTimeout(a,1e3/60)},global[NS]=global[NS]||function(img_path,viewer_selector,set_1,set_2){var op_1,op_2,viewer=document.querySelector(viewer_selector),img=new Image;viewer.addEventListener(events.touchMove,function(a){a.preventDefault()}),img.onload=function(){with(viewer.style)position="relative",margin="0",width=img.width+"px",height=img.height+"px",background="url("+img_path+") no-repeat left top",zoom=isSmartphone?"0,5":"1";op_1=new Oppai(img,viewer,set_1.vertex,set_1.rect),op_2=new Oppai(img,viewer,set_2.vertex,set_2.rect)},img.src=img_path},Oppai.prototype={constructor:Oppai,init:function(a,b,c,d){var e=35;this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.img=a,this.width=d[1][0]-d[0][0],this.height=d[1][1]-d[0][1],this.rootCoords={x:d[0][0],y:d[0][1]},this.vertex={x:c[0]-d[0][0],y:c[1]-d[0][1]},this.coords=[{x:0,y:0},{x:this.width,y:0},{x:this.width,y:this.height},{x:0,y:this.height}],this.threshold={min:{x:this.vertex.x-e,y:this.vertex.y-e},max:{x:this.vertex.x+e,y:this.vertex.y+e}},this.animation=new Animation2D("bounseout"),this.canvas.width=this.width,this.canvas.height=this.height;var f=this.canvas.style;f.position="absolute",f.top=d[0][1]+"px",f.left=d[0][0]+"px",this.canvas.addEventListener(events.touchStart,this,!1),this.canvas.addEventListener(events.touchMove,this,!1),this.canvas.addEventListener(events.touchEnd,this,!1),"ondevicemotion"in global&&global.addEventListener("devicemotion",this,!1),b.appendChild(this.canvas),this.draw()},draw:function(){this.ctx.drawImage(this.img,this.rootCoords.x,this.rootCoords.y,this.width,this.height,0,0,this.width,this.height)},transform:function(a){var b,c,d=this.ctx;d.clearRect(0,0,this.width,this.height);for(var e=0,f=3;f>=e;++e)b=this.coords[e],c=this.coords[e!==f?e+1:0],d.save(),d.beginPath(),d.moveTo(b.x,b.y),d.lineTo(c.x,c.y),d.lineTo(a.x,a.y),d.closePath(),d.clip(),this.triangles[e].call(this,a),this.draw(),d.restore()},triangles:[function(a){this.ctx.setTransform(1,0,(a.x-this.vertex.x)/this.height,(a.y-this.vertex.y)/this.height+1,0,0)},function(a){var b=this.vertex.x-a.x,c=this.vertex.y-a.y;this.ctx.setTransform(b/this.width+1,c/this.width,0,1,-b,-c)},function(a){var b=this.vertex.x-a.x,c=this.vertex.y-a.y;this.ctx.setTransform(1,0,b/this.height,c/this.height+1,-b,-c)},function(a){this.ctx.setTransform((a.x-this.vertex.x)/this.width+1,(a.y-this.vertex.y)/this.width,0,1,0,1)}],handleEvent:function(a){switch(a.preventDefault(),a.type){case"devicemotion":this._startVertex||this._deviceMotion(a);break;case events.touchStart:this._touchStart(a);break;case events.touchMove:!this.animation.playing&&this._startVertex&&this._touchMove(a);break;case events.touchEnd:this._startVertex&&this._touchEnd(a)}},_deviceMotion:function(a){var b,c=this,d=5*a.acceleration.x|0,e=5*a.acceleration.y|0;b=this._getRangedVertex({x:d+this.vertex.x,y:e+this.vertex.y}),global.setTimeout(function(){!this._startVertex&&c.transform(b)})},_touchAnimation:function(a){var b=this;this.animation.play(a,this.vertex,600,function(a,c){b.transform(a),c||(b._startVertex=null)})},_touchStart:function(a){this._startVertex=this._getTouchVertex(a)},_touchMove:function(a){var b=this._getTouchVertex(a,!0);this.transform(b)},_touchEnd:function(a){var b=this._getTouchVertex(a,!0);this._touchAnimation(b)},_getRangedVertex:function(a){return{x:getRangedNumber(a.x,this.threshold.min.x,this.threshold.max.x),y:getRangedNumber(a.y,this.threshold.min.y,this.threshold.max.y)}},_getTouchVertex:function(a,b){var c={x:getTouchInfo(a,"pageX")-(isSmartphone?.5*this.rootCoords.x:this.rootCoords.x),y:getTouchInfo(a,"pageY")-(isSmartphone?.5*this.rootCoords.y:this.rootCoords.y)};return b?this._getRangedVertex(c):c}},Animation2D.prototype={constructor:Animation2D,init:function(a){return this.type=a,this.easing=easingFunctions[a],this},play:function(a,b,c,d,e){this.set(a,b,c,d,e),this.exec()},stop:function(){this._continue=!1},set:function(a,b,c,d,e){this.from=a,this.to=b,this.changein={x:b.x-a.x,y:b.y-a.y},this.duration=c,this.callback=d,e&&this.init(e)},exec:function(){function a(){b._animate()&&global.requestAnimationFrame(a)}var b=this;this.startAt=new Date,this._continue=!0,a()},_animate:function(){var a=new Date-this.startAt,b={};return this.playing=this._continue&&a<=this.duration,b.x=this.playing?this.easing(a,this.from.x,this.changein.x,this.duration):this.to.x,b.y=this.playing?this.easing(a,this.from.y,this.changein.y,this.duration):this.to.y,this.callback(b,this.playing),this.playing}}}(this,document,void 0);
//# sourceMappingURL=oppai.min.js.map