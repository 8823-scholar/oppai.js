/*! oppai.js / @version:0.0.0 @author:dameleon <dameleon@gmail.com> @license:MIT */ 
!function(a,b,c){function d(a,b,c,e){return this instanceof d?this.init(a,b,c,e):new d(a,b,c,e)}function e(a){return this instanceof e?this.init(a):new e(a)}function f(a,b,c){return b>=a?b:a>=c?c:a}function g(a,b){return i?a.changedTouches[0][b]:a[b]}var h="oppai",i="ontouchstart"in a,j={touchStart:i?"touchstart":"mousedown",touchMove:i?"touchmove":"mousemove",touchEnd:i?"touchend":"mouseup"},k=c.env.android||c.env.ios,l={linear:function(a,b,c,d){return c*a/d+b},bounseout:function(a,b,c,d){return(a/=d)<1/3?10.5625*c*a*a+b:2/3>a?c*(10.5625*(a-=1.5/2.75)*a+.75)+b:2.5/3>a?c*(10.5625*(a-=2.25/2.75)*a+.9375)+b:c*(10.5625*(a-=2.625/2.75)*a+.984375)+b}};a.requestAnimationFrame=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)},a[h]=a[h]||function(a,b,e,f){var g,h,i=c(b),l=new Image;i.on(j.touchMove,function(a){a.preventDefault()}),l.onload=function(){i.css({position:"relative",margin:"0",width:l.width+"px",height:l.height+"px",background:"url("+a+") no-repeat left top",zoom:k?"0.5":"1"}),g=new d(l,i.get(),e.vertex,e.rect),h=new d(l,i.get(),f.vertex,f.rect)},l.src=a},d.prototype={constructor:d,init:function(d,f,g,h){var i=35;this.canvas=b.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.img=d,this.width=h[1][0]-h[0][0],this.height=h[1][1]-h[0][1],this.rootCoords={x:h[0][0],y:h[0][1]},this.vertex={x:g[0]-h[0][0],y:g[1]-h[0][1]},this.coords=[{x:0,y:0},{x:this.width,y:0},{x:this.width,y:this.height},{x:0,y:this.height}],this.threshold={min:{x:this.vertex.x-i,y:this.vertex.y-i},max:{x:this.vertex.x+i,y:this.vertex.y+i}},this.animation=new e("bounseout"),this.canvas.width=this.width,this.canvas.height=this.height,c(this.canvas).css({position:"absolute",top:h[0][1]+"px",left:h[0][0]+"px"}),this.canvas.addEventListener(j.touchStart,this,!1),this.canvas.addEventListener(j.touchMove,this,!1),this.canvas.addEventListener(j.touchEnd,this,!1),c.env.ios&&a.addEventListener("devicemotion",this,!1),f.appendChild(this.canvas),this.draw()},draw:function(){this.ctx.drawImage(this.img,this.rootCoords.x,this.rootCoords.y,this.width,this.height,0,0,this.width,this.height)},transform:function(a){var b,c,d=this.ctx;d.clearRect(0,0,this.width,this.height);for(var e=0,f=3;f>=e;++e)b=this.coords[e],c=this.coords[e!==f?e+1:0],d.save(),d.beginPath(),d.moveTo(b.x,b.y),d.lineTo(c.x,c.y),d.lineTo(a.x,a.y),d.closePath(),d.clip(),this.triangles[e].call(this,a),this.draw(),d.restore()},triangles:[function(a){this.ctx.setTransform(1,0,(a.x-this.vertex.x)/this.height,(a.y-this.vertex.y)/this.height+1,0,0)},function(a){var b=this.vertex.x-a.x,c=this.vertex.y-a.y;this.ctx.setTransform(b/this.width+1,c/this.width,0,1,-b,-c)},function(a){var b=this.vertex.x-a.x,c=this.vertex.y-a.y;this.ctx.setTransform(1,0,b/this.height,c/this.height+1,-b,-c)},function(a){this.ctx.setTransform((a.x-this.vertex.x)/this.width+1,(a.y-this.vertex.y)/this.width,0,1,0,1)}],handleEvent:function(a){switch(a.preventDefault(),a.type){case"devicemotion":this._startVertex||this._deviceMotion(a);break;case j.touchStart:this._touchStart(a);break;case j.touchMove:!this.animation.playing&&this._startVertex&&this._touchMove(a);break;case j.touchEnd:this._startVertex&&this._touchEnd(a)}},_deviceMotion:function(b){var c,d=this,e=5*b.acceleration.x|0,f=5*b.acceleration.y|0;c=this._getRangedVertex({x:e+this.vertex.x,y:f+this.vertex.y}),a.setTimeout(function(){!this._startVertex&&d.transform(c)})},_touchAnimation:function(a){var b=this;this.animation.play(a,this.vertex,600,function(a,c){b.transform(a),c||(b._startVertex=null)})},_touchStart:function(a){this._startVertex=this._getTouchVertex(a)},_touchMove:function(a){var b=this._getTouchVertex(a,!0);this.transform(b)},_touchEnd:function(a){var b=this._getTouchVertex(a,!0);this._touchAnimation(b)},_getRangedVertex:function(a){return{x:f(a.x,this.threshold.min.x,this.threshold.max.x),y:f(a.y,this.threshold.min.y,this.threshold.max.y)}},_getTouchVertex:function(a,b){var c={x:g(a,"pageX")-(k?.5*this.rootCoords.x:this.rootCoords.x),y:g(a,"pageY")-(k?.5*this.rootCoords.y:this.rootCoords.y)};return b?this._getRangedVertex(c):c}},e.prototype={constructor:e,init:function(a){return this.type=a,this.easing=l[a],this},play:function(a,b,c,d,e){this.set(a,b,c,d,e),this.exec()},stop:function(){this._continue=!1},set:function(a,b,c,d,e){this.from=a,this.to=b,this.changein={x:b.x-a.x,y:b.y-a.y},this.duration=c,this.callback=d,e&&this.init(e)},exec:function(){function b(){c._animate()&&a.requestAnimationFrame(b)}var c=this;this.startAt=new Date,this._continue=!0,b()},_animate:function(){var a=new Date-this.startAt,b={};return this.playing=this._continue&&a<=this.duration,b.x=this.playing?this.easing(a,this.from.x,this.changein.x,this.duration):this.to.x,b.y=this.playing?this.easing(a,this.from.y,this.changein.y,this.duration):this.to.y,this.callback(b,this.playing),this.playing}}}(this,document,this.tt);
//# sourceMappingURL=oppai.min.js.map